Name: Load Balancer with HAProxy for Chef Server (RightLink 10)
Description: "Load Balancer with HAProxy for Chef Server ServerTemplate.   RightLink10
  is a new agent to connect servers to the RightScale platform that is very lightweight
  and simple to install.\r\n_It is not a plug-in upgrade from the older RightLink
  v6 series._\r\nSee [http://docs.rightscale.com/rl/about.html](http://docs.rightscale.com/rl/about.html)
  for details.\r\n\r\nIn addition to installing HAProxy, this ServerTemplate runs
  a script to update the packaging system and enable automatic security updates, and
  a collectd install script to enable RightScale monitoring. \r\n\r\nThe ServerTemplate
  can run on most any Linux distro that supports cloud-init. It is recommended to
  use the standard distro images in various clouds.\r\n\r\n__ Requirements__\r\n\r\n
  * Chef Server or Hosted Chef\r\n * [rs-haproxy](https://github.com/rightscale-cookbooks/rs-haproxy)
  ([1.2.0](https://github.com/rightscale-cookbooks/rs-haproxy/releases/tag/v1.2.0))\r\n\r\n__Key
  Features:__\r\n\r\n * Downloads source code, builds, and installs HAProxy and configures
  the server to act as the front-end for all HTTP(S) requests.\r\n * Recipe to attach
  existing application servers in the deployment.\r\n * Recipe to set up load balancer
  machine tags on the server.\r\n * Monitoring HAProxy process.\r\n * Basic set of
  recipes for a RightLink-based server with logging, monitoring, alerts, tagging,
  etc.\r\n * MultiCloud Images that reference the latest supported images with a frozen
  and tested software repository date.\r\n * Basic set of alerts for most server type
  monitoring.\r\n * Examples of system-required input variables.\r\n\r\n__Documentation:__
  \ \r\n\r\n* [Overview](http://docs.rightscale.com/st/rl10/lb/overview.html)  \r\n*
  [Tutorial](http://docs.rightscale.com/st/rl10/lb/tutorial.html)  \r\n\r\n* * *\r\n\r\n__Tested
  Linux distros:__\r\n\r\n* Ubuntu 14.04 x86_64\r\n\r\n\r\n__Tested compute clouds:__\r\n\r\n*
  AWS"
Inputs:
  APPLICATION_ACTION: blank
  APPLICATION_BIND_IP: blank
  APPLICATION_BIND_PORT: blank
  APPLICATION_SERVER_ID: blank
  CHEF_SERVER_SSL_CERT: blank
  CHEF_SERVER_URL: blank
  CHEF_VALIDATION_KEY: blank
  CHEF_VALIDATION_NAME: blank
  COLLECTD_SERVER: env:RS_TSS
  POOL_NAME: blank
  RS_INSTANCE_UUID: env:RS_INSTANCE_UUID
  SSL_CERT: blank
  SSL_INCOMING_PORT: blank
  STATS_PASSWORD: blank
  STATS_USER: blank
  VERSION: blank
  VHOST_PATH: blank
RightScripts:
  Boot:
  - RL10_Linux_Wait_For_EIP.sh
  - RL10_Linux_Setup_Hostname.sh
  - RL10_Linux_Upgrade.sh
  - RL10_Linux_Setup_Automatic_Upgrade.sh
  - RL10_Linux_Collectd.sh
  - Chef_Client_Install.sh
  - HAProxy_Install-chef.sh
  - HAProxy_Frontend-chef.sh
  - HAProxy_Schedule-chef.sh
  Decommission:
  - RL10_Linux_Shutdown_Reason.sh
  - Chef_Client_Delete_Node.sh
  Operational:
  - HAProxy_Frontend-chef.sh
  - HAProxy_Schedule-chef.sh
  - RL10_Linux_Setup_Automatic_Upgrade.sh
  - RL10_Linux_Upgrade.sh
MultiCloudImages:
- Name: RHEL_7.1_x64
  Description: Red Hat Enterprise Linux (RHEL) 7.1 64-bit architecture (x64) and has
    tags to enable RightLink 10.x at boot.
  Revision: 13
  Publisher: RightScale
- Name: Debian_7.8_x64
  Description: Debian 7.8 64-bit architecture (x64) and has tags to enable RightLink
    10.x at boot.
  Revision: 13
  Publisher: RightScale
- Name: RHEL_6.6_x64
  Description: Red Hat Enterprise Linux (RHEL) 6.6 64-bit architecture (x64) and has
    tags to enable RightLink 10.x at boot.
  Revision: 12
  Publisher: RightScale
- Name: CentOS_7.1_x64
  Description: CentOS 7.1 64-bit architecture (x64) and has tags to install RightLink
    10.x at boot.
  Revision: 15
  Publisher: RightScale
- Name: Ubuntu_14.04_x64
  Description: Ubuntu 14.04 64-bit architecture (x64) and has tags to install RightLink
    10.x at boot.
  Revision: 28
  Publisher: RightScale
- Name: Ubuntu_12.04_x64
  Description: Ubuntu 12.04 64-bit architecture (x64) and has tags to install RightLink
    10.x at boot.
  Revision: 27
  Publisher: RightScale
- Name: CentOS_6.7_x64_KVM
  Description: "CentOS 6.7 64-bit architecture (x64) for the KVM hypervisor and has
    tags to install RightLink 10.x at boot.\r\n\r\n\r\n\r\nYou can download the image
    used on this MCI here:\r\n\r\n[OpenStack](http://cloud.centos.org/centos/6/images/CentOS-6-x86_64-GenericCloud-1601.qcow2)"
  Revision: 14
  Publisher: RightScale
- Name: CentOS_7.2_x64_KVM
  Description: "CentOS 7.2 64-bit architecture (x64) for the KVM hypervisor and has
    tags to install RightLink 10.x at boot.\r\n\r\n\r\nYou can download the image
    used on this MCI here:\r\n\r\n[OpenStack](http://cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud-1601.qcow2)"
  Revision: 13
  Publisher: RightScale
- Name: Ubuntu_12.04_x64_KVM
  Description: "Ubuntu 12.04 64-bit architecture (x64) for the KVM hypervisor and
    has tags to install RightLink 10.x at boot.\r\n\r\n\r\nYou can download the image
    used on this MCI here:\r\n\r\n[OpenStack](https://cloud-images.ubuntu.com/releases/12.04.4/release-20160201/ubuntu-12.04-server-cloudimg-amd64-disk1.img)"
  Revision: 15
  Publisher: RightScale
- Name: Ubuntu_14.04_x64_KVM
  Description: "Ubuntu 14.04 64-bit architecture (x64) for the KVM hypervisor and
    has tags to install RightLink 10.x at boot.\r\n\r\n\r\nYou can download the image
    used on this MCI here:\r\n\r\n[OpenStack](https://cloud-images.ubuntu.com/releases/14.04.3/release-20160201/ubuntu-14.04-server-cloudimg-amd64-disk1.img)"
  Revision: 15
  Publisher: RightScale
Alerts:
- Name: instance terminated
  Description: Raises alert if instance terminates abnormally, i.e., not through the
    RightScale interface or by an elasticity daemon (only for server arrays).
  Clause: If RS/server.state == terminated for 1 minutes Then escalate critical
- Name: instance stranded
  Description: Raises alert if instance enters the stranded state.
  Clause: If RS/server-failure.state == stranded for 1 minutes Then escalate warning
- Name: instance not responding
  Description: Raises alert if instance fails to send monitoring information within
    a given duration, based on the conditions set for this alert.
  Clause: If cpu-0/cpu-idle.value == NaN for 30 minutes Then escalate warning
- Name: cpu busy
  Description: Raises alert if average idle time is too low, based on the conditions
    set for this alert.
  Clause: If cpu-0/cpu-idle.value < 15 for 60 minutes Then escalate warning
- Name: cpu overloaded
  Description: Raises alert if average idle time is too low, based on the conditions
    set for this alert.
  Clause: If cpu-0/cpu-idle.value < 3 for 30 minutes Then escalate critical
- Name: cpu I/O wait
  Description: Raises alert if average disk I/O is too high, based on the conditions
    set for this alert.
  Clause: If cpu-0/cpu-wait.value > 40 for 30 minutes Then escalate warning
- Name: high network rx activity
  Clause: If interface-eth0/if_octets.rx > 50000000 for 30 minutes Then escalate critical
- Name: 'high network tx activity '
  Clause: If interface-eth0/if_octets.tx > 50000000 for 30 minutes Then escalate critical
- Name: low space in root partition
  Description: Escalates to Critical Alert if space drops below 1G
  Clause: If df-root/df_complex-free.value < 1000000000 for 5 minutes Then escalate
    critical
